function Tree(){this.root,this.currentRoot,this.orderedNodes=[],this.allNodes=[],this.anToNodeLookup=new Hashtable,this.nodePositions,this.scale=100,this.red="rgb(255, 0, 0)",this.green="rgb(0, 204, 0)",this.purple="rgb(0, 119, 255)",this.orange="rgb(255, 153, 0)",this.turquoise="rgb(0, 255, 255)",this.backgroundColor="rgb(207, 226, 245)",this.markerWidth=4,this.imageOffset=10,this.circleRadius=2,this.characterWidth,this.view=0,this.graphObject,Tree.prototype.parse=function(e){void 0===this.root&&(this.root=new Node,this.root.parse(this.root,e,this.anToNodeLookup),this.currentRoot=this.root),this.setNumLeavesInTree(this.root),this.setupNodes(this.currentRoot)},Tree.prototype.setCharacterWidth=function(e){this.characterWidth=e},Tree.prototype.getNode=function(e){return this.anToNodeLookup.get(e)},Tree.prototype.setNumLeavesInTree=function(e){var t=e.getChildren();if(void 0!==t){for(var r=0,o=0;o<t.length;o++){var i=t[o];this.setNumLeavesInTree(i);var s=i.getNumLeavesInTree();r+=++s}e.setNumLeavesInTree(r)}else e.setNumLeavesInTree(0)},Tree.prototype.setNodeOrdering=function(){this.graphObject=void 0,this.orderedNodes.length=0,this.reorderNodes(this.currentRoot)},Tree.prototype.reorderNodes=function(e){if(0===this.view){if(!0===e.isTerminus())return void this.orderedNodes.push(e);if(void 0===(t=e.getChildren()))return;for(r=0;r<t.length;r++){o=t[r];this.reorderNodes(o)}}else{if(this.orderedNodes.push(e),!0===e.isTerminus())return;var t=e.getChildren();if(void 0===t)return;for(var r=0;r<t.length;r++){var o=t[r];this.reorderNodes(o)}}},Tree.prototype.expandAllSubfamilyNodes=function(){this.currentRoot.expandAllSubfamilyNodes(this.currentRoot),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.expandAllNodes=function(){this.currentRoot.expandAllNodes(this.currentRoot),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.resetRootToMain=function(){this.currentRoot=this.root,this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.collapseLowestLevelSubfamily=function(){this.currentRoot.collapseLowestLevelSf(this.currentRoot),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.setScale=function(e){this.scale=e,this.graphObject=void 0},Tree.prototype.ladderTop=function(){this.ladder(this.root,!1),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.ladderBottom=function(){this.ladder(this.root,!0),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.ladderOriginal=function(){this.ladderTreeOriginal(this.root),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.ladderSort=function(e){return function(t,r){return!1===e?t.getNumLeavesInTree()<r.getNumLeavesInTree()?1:t.getNumLeavesInTree()>r.getNumLeavesInTree()?-1:0:t.getNumLeavesInTree()<r.getNumLeavesInTree()?-1:t.getNumLeavesInTree()>r.getNumLeavesInTree()?1:0}},Tree.prototype.ladderSortOriginal=function(){return function(e,t){return e.getOriginalNodeOrder()>t.getOriginalNodeOrder()?1:e.getOriginalNodeOrder()<t.getOriginalNodeOrder()?-1:0}},Tree.prototype.ladder=function(e,t){if(void 0!==e.children){e.getChildren().sort(this.ladderSort(t));for(var r=e.getChildren(),o=0;o<r.length;o++)this.ladder(r[o],t)}},Tree.prototype.ladderTreeOriginal=function(e){if(void 0!==e.children){e.getChildren().sort(this.ladderSortOriginal());for(var t=e.getChildren(),r=0;r<t.length;r++)this.ladderTreeOriginal(t[r])}},Tree.prototype.setupNodes=function(e){if(0===this.view){if(this.allNodes.push(e),!0===e.isTerminus())return void this.orderedNodes.push(e);if(void 0===(t=e.getChildren()))return;for(r=0;r<t.length;r++){o=t[r];this.setupNodes(o)}}else{if(!0===e.isTerminus())return void this.orderedNodes.push(e);this.orderedNodes.push(e);var t=e.getChildren();if(void 0===t)return;for(var r=0;r<t.length;r++){var o=t[r];this.setupNodes(o)}}},Tree.prototype.colorBySubfamily=function(){for(var e=new DefaultColorPreferences,t=e.getCustomColors(),r=t.length,o=e.getSubfamilyLeafSpecifier(),i=e.getSubfamilyLeafColor(),s=0,n=void 0,h=new Hashtable,d=0;d<this.allNodes.length;d++){var a=this.allNodes[d];if(!0!==a.isLeaf()){var l=this.getSubfamilyAncestor(a);if(void 0!==l&&(void 0===n||n!==l)&&(n=l,null===h.get(l)))if(h.put(l,l),!0===o&&l.isLeaf())this.setSubtreeColorForAllNonSfLeafNodes(l,i);else{var u=s%r;this.setSubtreeColorForAllNonSfLeafNodes(l,t[u]),s++}}}},Tree.prototype.getSubfamilyAncestor=function(e){if(null!==e&&void 0!==e)return void 0!==e.getSubfamilyInfo()?e:this.getSubfamilyAncestor(e.getParent())},Tree.prototype.setSubtreeColorForAllNonSfLeafNodes=function(e,t){if(void 0!==e){e.setColor(t);var r=e.getChildren();if(void 0!==r)for(var o=0;o<r.length;o++){var i=r[o];void 0===i.getSubfamilyInfo()&&this.setSubtreeColorForAllNonSfLeafNodes(i,t)}}},Tree.prototype.getNumNodes=function(){return this.orderedNodes.length},Tree.prototype.getNodes=function(){return this.orderedNodes},Tree.prototype.getAllNodes=function(){return this.allNodes},Tree.prototype.setNodePositions=function(e){this.nodePositions=e;var t=e.length;this.orderedNodes.length<t&&(t=this.orderedNodes.length);for(var r=0;r<t;r++)this.orderedNodes[r].setPosition(this.nodePositions[r]);0===this.view?this.calculateInternalNodePositions(this.currentRoot):this.calculateNodePositions(this.currentRoot,0)},Tree.prototype.resetGraphObject=function(){this.graphObject=void 0},Tree.prototype.getTreeHeight=function(){var e=this.orderedNodes[this.orderedNodes.length-1].getPosition();return e.getY()+e.getHeight()},Tree.prototype.calculateNodePositions=function(e,t){var r=new RowTopHeight,o=this.nodePositions[t];if(r.setY(o.getY()),r.setHeight(o.getHeight()),e.setPosition(r),!0===e.isTerminus())return t+1;for(var i=t+1,s=e.getChildren(),n=0;n<s.length;n++){var h=s[n];i=this.calculateNodePositions(h,i)}return i},Tree.prototype.calculateInternalNodePositions=function(e){if(!e.isTerminus()){for(var t=e.getChildren(),r=0;r<t.length;r++)this.calculateInternalNodePositions(t[r]);var o=new RowTopHeight;if(t.length%2==0){var i=t[0].getPosition(),s=t[t.length-1].getPosition(),n=s.getY()+s.getHeight()-i.getY();o.setHeight(n/t.length),o.setY((i.getY()+s.getY()+s.getHeight())/2-o.getHeight()/2)}else{var h=t[Math.floor((t.length+1)/2)-1].getPosition();o.setY(h.getY()),o.setHeight(h.getHeight())}e.setPosition(o)}},Tree.prototype.getTreeSVG=function(e){if(void 0===this.graphObject){var t={backgroundStruct:"",treeStruct:"",markerStruct:""};this.getSVGInfo(this.currentRoot,e,t),this.graphObject=t}return this.graphObject.backgroundStruct+this.graphObject.treeStruct+this.graphObject.markerStruct},Tree.prototype.getGraphicSubfamilyInternalNode=function(e,t,r){var o=t+r/2,i=e-this.markerWidth;return"<polygon points='"+i+","+o+" "+e+","+(o+this.markerWidth)+" "+(e+this.markerWidth)+","+o+" "+e+","+(o-this.markerWidth)+" "+i+","+o+"' style='fill:"+this.purple+"; stroke:black;stroke-width:1; '></polygon>"},Tree.prototype.getGraphicCollapsedRerootedSubfamily=function(e,t,r){return this.getGraphicCollapsed(e,t,r,this.purple)},Tree.prototype.getGraphicRerootedDuplication=function(e,t,r){return this.getGraphicRerooted(e,t,r,this.orange)},Tree.prototype.getGraphicRerootedHorizontalTransfer=function(e,t,r){return this.getGraphicRerooted(e,t,r,this.turquoise)},Tree.prototype.getGraphicRerootedNonDupHorizontalTransfer=function(e,t,r){return this.getGraphicRerooted(e,t,r,this.green)},Tree.prototype.getGraphicRerootedCollapsedNonSubfamily=function(e,t,r){return this.getGraphicRerooted(e,t,r,this.red)},Tree.prototype.getGraphicCollapsed=function(e,t,r,o){var i=t+r/2,s=e-this.markerWidth,n=i+this.markerWidth,h=e+this.markerWidth;return"<polygon points='"+s+","+i+" "+h+","+n+" "+h+","+(i-this.markerWidth)+" "+s+","+i+"' style='fill:"+o+"; stroke:black;stroke-width:1; '></polygon>"},Tree.prototype.getGraphicRerooted=function(e,t,r,o){var i=t+r/2,s=e-this.markerWidth,n=i+this.markerWidth,h=e+this.markerWidth,d=i-this.markerWidth;return"<polygon points='"+s+","+d+" "+s+","+n+" "+h+","+i+" "+s+","+d+"' style='fill:"+o+"; stroke:black;stroke-width:1; '></polygon>"},Tree.prototype.getGraphicExpandedDuplication=function(e,t,r){return this.getGraphicCircle(e,t,r,this.orange)},Tree.prototype.getGraphicExpandedHozuzontalTransfer=function(e,t,r){return this.getGraphicCircle(e,t,r,this.turquoise)},Tree.prototype.getGraphicExpandedNonDupHorTrans=function(e,t,r){return this.getGraphicCircle(e,t,r,this.green)},Tree.prototype.getGraphicCollapsedNonSubfamily=function(e,t,r){return this.getGraphicCollapsed(e,t,r,this.red)},Tree.prototype.getGraphicCircle=function(e,t,r,o){var i=t+r/2,s=e-this.markerWidth;this.markerWidth,this.markerWidth,this.markerWidth;return"<circle + cx='"+s+"'  cy='"+i+"' r='"+this.markerWidth+"' stroke='black' stroke-width='1' fill='"+o+"'> </circle>"},Tree.prototype.getSVGInfo=function(e,t,r){var o=e.getPosition(),i=(e.getBranchLength()+e.getCumulativeBranchLength())*this.scale+this.imageOffset,s=o.getY()+o.getHeight()/2,n=s;if(void 0!==e.getBgColor()&&(r.backgroundStruct=r.backgroundStruct+"<rect x='0' y='"+o.getY()+"' width='100%' height='"+o.getHeight()+"' fill='"+e.getBgColor()+"' />\n"),this.currentRoot===e);else{var h=e.getParent(),d=h.getPosition(),a=(h.getBranchLength()+h.getCumulativeBranchLength())*this.scale+this.imageOffset,l=a,u=d.getY()+d.getHeight()/2,g=h.getColor();r.treeStruct=r.treeStruct+"<line x1='"+l+"'  y1='"+u+"'  x2='"+l+"'  y2='"+n+"' style='stroke:"+g+"; stroke-width:1' />\n<line x1='"+l+"'  y1='"+n+"'  x2='"+i+"'  y2='"+s+"' style='stroke:"+g+"; stroke-width:1' />\n"}var p=this.getMarkerColor(e),c=e.getColor();if(!0!==e.isSubfamily()||!0!==e.isLeaf()&&1!=e.isExpanded()){if(!1===e.isLeaf())if(this.currentRoot===e&&this.currentRoot!==this.root){var f=i-this.markerWidth,m=s+this.markerWidth,v=i+this.markerWidth,N=s-this.markerWidth;r.markerStruct=r.markerStruct+"<polygon id='"+e.getAnnotationNodeId()+"' onmousedown='mouseDown(evt);' points='"+f+","+N+" "+f+","+m+" "+v+","+s+" "+f+","+N+"' style='fill:"+p+"; stroke:black;stroke-width:1;cursor: pointer;'><title>"+e.getLabel()+"</title></polygon>\n"}else if(1==e.isTerminus()){var f=i,m=s+this.markerWidth,v=i+2*this.markerWidth,N=s-this.markerWidth;r.markerStruct=r.markerStruct+"<polygon id='"+e.getAnnotationNodeId()+"' onmousedown='mouseDown(evt);' points='"+f+","+s+" "+v+","+m+" "+v+","+N+" "+f+","+s+"' style='fill:"+p+"; stroke:black;stroke-width:1;cursor: pointer;'><title>"+e.getLabel()+"</title></polygon>\n"}else r.markerStruct=r.markerStruct+"<circle id='"+e.getAnnotationNodeId()+"' onmousedown='mouseDown(evt);' cx='"+i+"'  cy='"+s+"' r='"+this.markerWidth+"' stroke='black' stroke-width='1' fill='"+p+"' cursor='pointer' >  <title>"+e.getTooltip()+"</title> </circle>\n"}else{var f=i-this.markerWidth,m=s+this.markerWidth,v=i+this.markerWidth,N=s-this.markerWidth;r.markerStruct=r.markerStruct+"<polygon id='"+e.getAnnotationNodeId()+"' onmousedown='mouseDown(evt);' points='"+f+","+s+" "+i+","+m+" "+v+","+s+" "+i+","+N+" "+f+","+s+"' style='fill:"+p+"; stroke:black;stroke-width:1;cursor: pointer;'><title>"+e.getLabel()+"</title></polygon>\n"}if(!0!==e.isTerminus()){if(1===this.view&&!1===e.isTerminus()){var y=o.getY()+o.getHeight()/2,T=e.getReferenceSpeciationEvent();void 0===T&&(T=e.getAnnotationNodeId()),r.markerStruct=r.markerStruct+"<text x='"+(i+2*this.markerWidth)+"' y='"+y+"' style='font-family: Arial, Helvetica, sans-serif;font-size:14px;line-height: 16px;dominant-baseline: middle;' fill='"+c+"'>"+T+"</text>\n"}for(var k=e.getChildren(),S=0;S<k.length;S++)this.getSVGInfo(k[S],t,r)}else{y=o.getY()+o.getHeight()/2;1===this.view?1==e.isLeaf()?r.markerStruct=r.markerStruct+"<text x='"+(i+2*this.markerWidth)+"' y='"+y+"' style='font-family: Arial, Helvetica, sans-serif;font-size:14px;line-height: 16px;line-height: 16px;dominant-baseline: middle;' fill='"+c+"'>"+e.getLeafNodeInfo().getOrganism()+" </text>\n":(void 0===(T=e.getReferenceSpeciationEvent())&&(T=e.getAnnotationNodeId()),r.markerStruct=r.markerStruct+"<text x='"+(i+2*this.markerWidth)+"' y='"+y+"' style='font-family: Arial, Helvetica, sans-serif;font-size:14px;line-height: 16px;dominant-baseline: middle;' fill='"+c+"'>"+T+"</text>\n"):r.markerStruct=r.markerStruct+"<text x='"+(i+2*this.markerWidth)+"' y='"+y+"' style='font-family: Arial, Helvetica, sans-serif;font-size:14px;line-height: 16px;dominant-baseline: middle;' fill='"+c+"'>"+e.getLabel()+" </text>\n"}},Tree.prototype.getMarkerColor=function(e){return void 0!==e.getSubfamilyInfo()?this.purple:!1===e.isExpanded()?this.red:!0===e.isDuplication()?this.orange:!0===e.isHorizontalTransfer()?this.turquoise:this.green},Tree.prototype.collapseExpand=function(e){var t=this.findNode(this.currentRoot,e);null!==t&&(t.isLeaf()||(t.setExpanded(!t.isExpanded()),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)))},Tree.prototype.reroot=function(e){var t=this.findNode(this.currentRoot,e);null!==t&&(t.isLeaf()||(this.currentRoot=t,this.setNodeOrdering(),this.setNodePositions(this.nodePositions)))},Tree.prototype.findNode=function(e,t){if(e.getAnnotationNodeId()===t)return e;if(!1===e.isExpanded)return null;var r=e.getChildren();if(void 0===r)return null;for(var o=null,i=0;i<r.length;i++)if(null!==(o=this.findNode(r[i],t))&&o.getAnnotationNodeId()===t)return o;return null},Tree.prototype.toggleView=function(){0===this.view?this.view=1:this.view=0,this.orderedNodes.length=0,this.allNodes.length=0,this.setupNodes(this.currentRoot),this.graphObject=void 0,this.setNodePositions(this.nodePositions)},Tree.prototype.moveToTop=function(e){e.moveToTop(e),this.setNodeOrdering(),this.setNodePositions(this.nodePositions)},Tree.prototype.expandSfSelectSf=function(e){for(var t=[],r=0;r<this.allNodes.length;r++){var o=this.allNodes[r];if(o.setBgColor(void 0),!1!==o.isSubfamily())for(var i=o.getSubfamilyInfo().getSubfamilyId(),s=0;s<e.length;s++)e[s]===i&&(o.getDescendent(o,t),t.push(o),o.expandAllNodes(o))}for(r=0;r<t.length;r++)t[r].setBgColor(this.backgroundColor);return this.setNodeOrdering(),this.setNodePositions(this.nodePositions),t},Tree.prototype.expandSfSelectSeq=function(e){for(var t=[],r=0;r<this.allNodes.length;r++){var o=this.allNodes[r];o.setBgColor(void 0);var i=o.getLeafNodeInfo();if(void 0!==i)for(var s=i.getNodeName(),n=0;n<e.length;n++){var h=s.split("|"),d=!1;if(e[n]===s&&(d=!0),0==d&&null!=h&&void 0!=h&&h.length>=3&&e[n]==h[1]&&(d=!0),0!=d){o.setBgColor(this.backgroundColor),t.push(o);var a=this.getSubfamilyAncestor(o);void 0!==a&&null!==a&&a.setExpanded(!0)}}}return this.setNodeOrdering(),this.setNodePositions(this.nodePositions),t}}