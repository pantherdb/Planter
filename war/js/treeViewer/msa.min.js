function MSA(){this.matchPositions=[],this.tallyLookup=[],this.titleDisplayFullSeq,this.titleDisplayMatchState,this.sequenceList=[],this.annotIdToSeq=new Hashtable,this.annotIdToMatchStateSeq=new Hashtable,this.nodeNameToWeight=new Hashtable,this.msafullSeqLength,this.weightInfoAvailable=!1,this.selectedIndex=-1,this.selectedAminoAcidStartPos=-1,this.selectedAminoAcidEndPos=-1,this.positionInterval=25,this.characterWidth,this.view_full=0,this.view_match_state=1,this.view_history=2,this.currentView=this.view_full,this.threshold=[80,60,40],this.colors=["rgb(21, 138, 255)","rgb(185, 220, 255)","rgb(220, 233, 255)"],this.color_white="rgb(255,255,255)",this.color_black="rgb(0,0,0)",this.color_selected_index="rgb(255,204,204)",this.color_selected_amino_acid_pos="rgb(255, 255, 0)",this.color_history_dif_text="rgb(255,0,0)",this.dot=".",this.dash="-",MSA.prototype.setSelectedIndex=function(t){t<-1||(this.selectedIndex=t-1)},MSA.prototype.setAminoAcidRange=function(t,e){t<-1||e<1||e<t||(this.selectedAminoAcidStartPos=t-1,this.selectedAminoAcidEndPos=e-1)},MSA.prototype.getMinSelectedIndexRange=function(){var t=this.selectedIndex;return this.selectedAminoAcidStartPos>0&&t<0?this.selectedAminoAcidStartPos:t>0&&this.selectedAminoAcidStartPos>0?Math.min(t,this.selectedAminoAcidStartPos):t},MSA.prototype.getColorPercentIdentity=function(t,e){if(!(null===t||null===e||e>this.matchPositions.length)){if("."===t||"-"===t)return this.color_white;var i=this.tallyLookup[e];if(null!==i){for(var s=i.get(t)/this.sequenceList.length*100,o=0;o<this.threshold.length;o++)if(s>this.threshold[o])return this.colors[o];return this.color_white}}},MSA.prototype.getSeqDisplay=function(t,e){if(this.currentView===this.view_history&&void 0!==e)return this.getHistoryDisplay(t,e);for(var i="",s=this.annotIdToSeq.get(t),o=void 0,n=0;n<s.length;n++)if(this.currentView!==this.view_match_state||!1!==this.matchPositions[n]){var h=s.charAt(n),r=null;(r=n===this.selectedIndex?this.color_selected_index:this.selectedAminoAcidStartPos<=n&&n<=this.selectedAminoAcidEndPos&&this.currentView!==this.view_match_state?this.color_selected_amino_acid_pos:this.getColorPercentIdentity(h,n))===o?i+=h:(i.length>0&&(i+="</span>"),i+="<span style=' font-size:14px; font-family: monospace; background-color: "+r+";'>",i+=h),o=r}return i},MSA.prototype.getHistoryDisplay=function(t,e){for(var i="",s=this.annotIdToSeq.get(t),o=this.annotIdToSeq.get(e),n=void 0,h=void 0,r=0;r<s.length;r++){var a=s.charAt(r),l=!1;void 0!==o&&a!==o.charAt(r)&&(l=!0);var c=null;c=r===this.selectedIndex?this.color_selected_index:this.selectedAminoAcidStartPos<=r&&r<=this.selectedAminoAcidEndPos&&this.currentView!==this.view_match_state?this.color_selected_amino_acid_pos:this.getColorPercentIdentity(a,r);var d=void 0;1==l&&(d=this.color_history_dif_text),c===n&&d===h?i+=a:(i.length>0&&(i+="</span>"),!1===l?(i+="<span style=' font-size:14px; font-family: monospace;background-color: "+c+";'>",i+=a):(i+="<span style=' font-size:14px; font-family: monospace;background-color: "+c+"; color: "+d+";'>",i+=a)),n=c,h=d}return i},MSA.prototype.getFullSeqHeader=function(){return this.titleDisplayFullSeq},MSA.prototype.getMatchSeqHeader=function(){return this.titleDisplayMatchState},MSA.prototype.setViewDefault=function(){this.currentView=this.view_full},MSA.prototype.setViewMatchState=function(){this.currentView=this.view_match_state},MSA.prototype.setViewHistory=function(){this.currentView=this.view_history},MSA.prototype.getCurrentView=function(){return this.currentView},MSA.prototype.setCharacterWidth=function(t){this.characterWidth=t},MSA.prototype.getCharacterWidth=function(){return this.characterWidth},MSA.prototype.getWidth=function(){var t=this.titleDisplayFullSeq;return this.view_match_state===this.currentView&&(t=this.titleDisplayMatchState),this.characterWidth*t.length},MSA.prototype.getSeqLength=function(){var t=this.titleDisplayFullSeq;return this.view_match_state===this.currentView&&(t=this.titleDisplayMatchState),t.length},MSA.prototype.getTitle=function(){return this.view_match_state===this.currentView?this.titleDisplayMatchState:this.titleDisplayFullSeq},MSA.prototype.getSeq=function(t){return this.annotIdToSeq.get(t)},MSA.prototype.getAminoAcidAlignPos=function(t,e){var i=e-1;if(i<0)return-1;var s=this.annotIdToSeq.get(t);if(null===s||void 0===s||s.length<e)return-1;var o=0;if(null!==s&&void 0!==s)for(var n=0;n<s.length;n++){var h=s.charAt(n);if(this.dot!==h&&this.dash!==h){if(o===i)return n+1;o++}}return-1},MSA.prototype.parse=function(t,e){this.sequenceList=t.annotation_node_asArray;for(g=0;g<this.sequenceList.length;g++){var i=this.sequenceList[g],s=i.accession,o=s.indexOf(":");o>=0&&(s=s.substring(o+1,s.length));var n=i.sequence,h=[],r=[];if(this.annotIdToSeq.put(s,n),0===g){this.msafullSeqLength=n.length;for(var a=0,l=0;l<this.msafullSeqLength;l++){if("."===(f=n.charAt(l))?this.matchPositions[l]=!1:"-"===f?(this.matchPositions[l]=!0,a++):f===f.toUpperCase()?(this.matchPositions[l]=!0,a++):this.matchPositions[l]=!1,this.tallyLookup[l]=new Hashtable,l>0&&(l+1)%this.positionInterval==0){h.push("|");for(var c=(l+1).toString(),d=0;d<c.length;d++)intervalChar=c[c.length-1-d],h[h.length-2-d]=intervalChar}else h.push(" ");if(!0===this.matchPositions[l])if(a>0&&(a+1)%this.positionInterval==0){r.push("|");for(var c=(a+1).toString(),d=0;d<c.length;d++)intervalChar=c[c.length-1-d],r[h.length-2-d]=intervalChar}else r.push(" ")}this.titleDisplayFullSeq=h.join(""),this.titleDisplayMatchState=r.join("")}for(l=0;l<this.msafullSeqLength;l++){var u=this.tallyLookup[l],p=n.charAt(l);"."!==p&&"-"!==p&&(null===(c=u.get(p))?u.put(p,1):u.put(p,c+1))}}if(null!==e&&void 0!==e){this.weightInfoAvailable=!0;for(var g=0;g<e.length;g++){var f=e[g],S=f.annotation_node_name,A=f.weight;this.nodeNameToWeight.put(S,parseFloat(A))}}}}