function mouseDown(e){var t=e.currentTarget.id,i=window.treeViewer.treeInfo,r=e.which;1===r?(console.log("left click"),i.collapseExpand(t)):3===r&&(e.preventDefault(),console.log("right click"),i.reroot(t)),window.treeViewer.handleSyncWithGridRowSize()}function TreeInitStatus(){this.sentRequest=!1,this.receivedResponse=!1,this.success=!1,this.response,this.responseInJSON;var e=new X2JS;TreeInitStatus.prototype.setResponseString=function(t){if(this.response=t,""!==this.response){var i=e.xml_str2json(t);null!==i&&(this.responseInJSON=i)}else this.responseInJSON={}}}function TreeInitData(){this.treeData=new TreeInitStatus,this.msa=new TreeInitStatus,this.familyName=new TreeInitStatus}function TreeViewer(){this.initData,this.stopExecution=!1,this.bookId,this.msaInfo,this.treeInfo,this.gridCols=["tree","gene_id","gene_name","organism","definition","subfamily_name"],this.gridLabels=["Tree","Gene Id","Gene Name","Organism","Definition","Subfamily Name"],this.msaCol="msa",this.calculatedRowHeights=!1,this.rowStartHeight=[],this.redoRowHeights=!0,this.columnModel,this.vScrollposition,this.hScrollPosition,this.selectedRow,this.selectedColPos,TreeViewer.prototype.displayLegend=function(){var e=new Tree,t='<svg width="15" height="15">'+e.getGraphicSubfamilyInternalNode(5,3,12)+"</svg>",i='<svg width="15" height="15">'+e.getGraphicCollapsedRerootedSubfamily(5,3,12)+"</svg>",r='<svg width="15" height="15">'+e.getGraphicExpandedDuplication(10,3,12)+"</svg>",o='<svg width="15" height="15">'+e.getGraphicExpandedHozuzontalTransfer(10,3,12)+"</svg>",n='<svg width="15" height="15">'+e.getGraphicExpandedNonDupHorTrans(10,3,12)+"</svg>",a='<svg width="15" height="15">'+e.getGraphicCollapsedNonSubfamily(5,3,12)+"</svg>",s='<svg width="15" height="15">'+e.getGraphicRerootedHorizontalTransfer(5,3,12)+"</svg>",d='<svg width="15" height="15">'+e.getGraphicRerootedDuplication(5,3,12)+"</svg>",l='<svg width="15" height="15">'+e.getGraphicRerootedNonDupHorizontalTransfer(5,3,12)+"</svg>",w='<svg width="15" height="15">'+e.getGraphicRerootedCollapsedNonSubfamily(5,3,12)+"</svg>";$("#legend").jqGrid({caption:"Legend",hiddengrid:!0,height:100,rownum:2,colModel:[{name:"symbol1",label:"",width:"20"},{name:"definition1",label:"",width:"375"}],cmTemplate:{sortable:!1},data:[{id:10,symbol1:t,definition1:"Expanded Subfamily node"},{id:20,symbol1:i,definition1:"Collapsed Subfamily node"},{id:30,symbol1:r,definition1:"Expanded duplication"},{id:40,symbol1:o,definition1:"Expanded horizontal transfer"},{id:50,symbol1:n,definition1:"Expanded speciation node"},{id:60,symbol1:l,definition1:"Rerooted speciation node"},{id:70,symbol1:d,definition1:"Rerooted expanded duplication"},{id:80,symbol1:s,definition1:"Rerooted expanded horizontal transfer"},{id:90,symbol1:w,definition1:"Rerooted collapsed non Subfamily node"},{id:100,symbol1:a,definition1:"Collapsed non Subfamily node"}]}),$("#gview_legend").find('div[role="columnheader"]').parent().hide()},TreeViewer.prototype.startProgressBar=function(){var e=$("<div id='progressbar' height='50%;width: 100%; style='color:#0000FF'/>"),t=$("#treeviewer");e.insertAfter(t);e.append("<div id= 'progressLabelId' class=\"progress-label\">Loading data from server...</div>"),e.progressbar({value:!1,change:function(){progressbar=document.getElementById("progressbar"),progressLabel=document.getElementById("progressLabelId"),$(progressLabel).text($(progressbar).progressbar("value")+"%")},complete:function(){progressLabel=document.getElementById("progressLabelId"),$(progressLabel).text("Complete!"),progressbar=document.getElementById("progressbar")}})},TreeViewer.prototype.loadInfoFromServer=function(){this.initData=new TreeInitData,this.bookId=this.getParameterByName("book");$.get("/searchTree?type=tree_info&book="+this.bookId,function(e){null!==e&&void 0!==e&&0!==e.length?window.treeViewer.initData.treeData.setResponseString((new XMLSerializer).serializeToString(e.documentElement)):window.treeViewer.initData.treeData.setResponseString("");var t=$("#progressbar").progressbar("option","value")+50;$("#progressbar").progressbar("option","value",t),window.treeViewer.setupTreeInfo(),!0!==window.treeViewer.stopExecution?window.treeViewer.initData.treeData.success=!0:window.treeViewer.initData.treeData.success=!1}).done(function(){}).fail(function(){window.treeViewer.initData.treeData.success=!1}).always(function(){window.treeViewer.initData.treeData.receivedResponse=!0,window.treeViewer.checkProgress(window.treeViewer.initData)});window.treeViewer.initData.treeData.sentRequest=!0;$.get("/searchTree?type=msa_info&book="+this.bookId,function(e){null!==e&&void 0!==e&&0!==e.length?window.treeViewer.initData.msa.setResponseString((new XMLSerializer).serializeToString(e.documentElement)):window.treeViewer.initData.msa.setResponseString("");var t=$("#progressbar").progressbar("option","value")+35;$("#progressbar").progressbar("option","value",t),window.treeViewer.setupMsaInfo(),window.treeViewer.initData.msa.success=!0}).done(function(){}).fail(function(){window.treeViewer.initData.msa.success=!1}).always(function(){window.treeViewer.initData.msa.receivedResponse=!0,window.treeViewer.checkProgress(window.treeViewer.initData)});window.treeViewer.initData.msa.sentRequest=!0;$.get("/searchTree?type=family_name&book="+this.bookId,function(e){window.treeViewer.initData.familyName.success=!0}).done(function(){}).fail(function(){}).always(function(){window.treeViewer.initData.familyName.receivedResponse=!0,window.treeViewer.checkProgress(window.treeViewer.initData)});window.treeViewer.initData.familyName.sentRequest=!0},TreeViewer.prototype.checkProgress=function(e){var t=document.getElementById("progressLabelId");if(!0!==window.treeViewer.stopExecution){if(!0===e.treeData.receivedResponse&&!0===e.msa.receivedResponse&&!0===e.familyName.receivedResponse)return!0===e.treeData.success&&!0===e.msa.success&&!0===e.familyName.success&&!0===this.parseDataAndDisplay()?(this.hideProgressBar(),$("#tree_slider").slider({min:1,max:500,value:100,stop:function(e,t){var i=t.value;window.treeViewer.treeInfo.setScale(i),window.treeViewer.displayTreeNoResize()}}),void($("#tree_slider").width=200)):void $(t).text("Unable to retrieve - Please check book id")}else $(t).text("Unable to retrieve - Please check book id")},TreeViewer.prototype.hideProgressBar=function(){var e=document.getElementById("progressbar");$(e).hide()},TreeViewer.prototype.parseDataAndDisplay=function(){this.setupMsaTreeInfo();this.treeInfo;$("#treeviewer").jqGrid({datatype:"local",colModel:columnModel,cmTemplate:{sortable:!1},autoResizing:{compact:!0},iconSet:"fontAwesome",gridview:!0,hoverrows:!1,autoencode:!0,ignoreCase:!0,viewrecords:!0,height:400,width:1e3,shrinkToFit:!1,caption:"Tree Attribute Viewer",resizeStop:function(e,t){var i=columnModel[t];if(0!=i.frozen){for(var r=0,o=0;o<columnModel.length;o++)1==(i=columnModel[o]).frozen&&(o==t?(r+=e,"Tree"===i.label&&!0):r+=i.width);$("#treeviewer").width();$("#gbox_treeviewer").width()+50<r&&$("#treeviewer").jqGrid("setGridWidth",r+50),console.log("resize of frozen column "+t+" to "+r+" pixels"),window.treeViewer.displayTreeNoResize()}else window.treeViewer.displayTreeNoResize()},beforeSelectRow:function(){return!1},gridComplete:function(){},onCellSelect:function(e,t,i,r){var o=window.treeViewer.treeInfo.getNode(e).getLeafNodeInfo();if(void 0!==o&&1==t){var n=o.getNodeName();if(null!=n&&void 0!=n){var a=window.location.href,s=a.indexOf(window.location.pathname);a=a.substring(0,s)+"/genes/gene.jsp?acc="+o.getNodeName(),window.open(a,"panthermain")}}},loadComplete:function(){if(null!==window.treeViewer.vScrollposition&&void 0!==window.treeViewer.vScrollposition&&$("#treeviewer").closest(".ui-jqgrid-bdiv").scrollTop(window.treeViewer.vScrollposition),null!==window.treeViewer.hScrollposition&&void 0!==window.treeViewer.hScrollposition&&$("#treeviewer").closest(".ui-jqgrid-bdiv").scrollLeft(window.treeViewer.hScrollposition),void 0!=window.treeViewer.selectedColPos&&null!==window.treeViewer.selectedColPos&&($("#treeviewer").closest(".ui-jqgrid-bdiv").scrollLeft(window.treeViewer.selectedColPos),window.treeViewer.selectedColPos=void 0),void 0!=window.treeViewer.selectedRow&&null!==window.treeViewer.selectedRow){var e=window.treeViewer.treeInfo.getNodes();if(null!==e&&void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];if(window.treeViewer.selectedRow===i.getAnnotationNodeId()){var r=$("#treeviewer")[0].rows[t],o=$("#gview_treeviewer").height(),n=$(r).outerHeight(!0)*e.length,a=(Math.floor(n/2),$(r).outerHeight(!0)*t);if(n<o||a<o)return void(window.treeViewer.selectedRow=void 0);if(a+o>n)return $("#treeviewer").closest(".ui-jqgrid-bdiv").scrollTop(a),void(window.treeViewer.selectedRow=void 0);$("#treeviewer").closest(".ui-jqgrid-bdiv").scrollTop(a-Math.floor(o/2)),window.treeViewer.selectedRow=void 0}}}window.treeViewer.selectedRow=void 0}}).jqGrid("gridResize",{stop:function(e,t,i){for(var r=$("#gbox_treeviewer").width(),o=0,n=$("#treeviewer").jqGrid("getGridParam","colModel"),a=0;a<n.length;a++){var s=n[a];1!=s.hidden&&(1==s.frozen&&(o+=s.width))}o+50>r&&$("#treeviewer").jqGrid("setGridWidth",o+50),window.treeViewer.displayTreeNoResize()}}),window.treeViewer.loadDataFromTree(),window.treeViewer.defaultProcessing(),window.treeViewer.displayTreeNoResize();var e=this.getParameterByName("sf"),t=this.getParameterByName("seq"),i=null;if(""!==e){var r=e.split(",");if(void 0!==(a=this.treeInfo.expandSfSelectSf(r))&&null!==a&&0<a.length){for(var o=a.length-1;o>0;o--)if(1==a[o].isTerminus()){this.selectedRow=a[o].getAnnotationNodeId();break}window.treeViewer.displayTreeNoResize()}}else if(""!==t){var n=t.split(","),a=this.treeInfo.expandSfSelectSeq(n);""!==this.getParameterByName("eHist")&&void 0!==a&&null!==a&&0<a.length&&(this.treeInfo.toggleView(),this.treeInfo.moveToTop(a[0]),window.treeViewer.hideGridInfo(!0),window.treeViewer.hideMSAInfo(!1),w2ui.toolbar.click("detailed"),window.treeViewer.treeInfo.toggleView(),window.treeViewer.handleSyncWithGridRowSize(),w2ui.toolbar.click("msa"),w2ui.toolbar.click("history"),window.treeViewer.switchMsaView("history")),void 0!==a&&null!==a&&0<a.length&&(window.treeViewer.selectedRow=a[0].getAnnotationNodeId()),window.treeViewer.displayTreeNoResize(),i=a[0].getAnnotationNodeId()}if(void 0!==this.msaInfo&&null!==this.msaInfo){var s=this.getParameterByName("seqStartPos"),d=this.getParameterByName("seqEndPos");if(""===d&&""!==s&&(d=s),null!==i&&void 0!==i&&1==$.isNumeric(s)&&1==$.isNumeric(d)){var l=this.msaInfo.getAminoAcidAlignPos(i,s),w=this.msaInfo.getAminoAcidAlignPos(i,d);this.selectSEQPosRange(l,w)}var h=this.getParameterByName("gridMSA"),g=this.getParameterByName("msaPos");""===g&&""==s&&""==d&&!0!==h||(""!==g&&this.selectMSAPos(g),window.treeViewer.hideGridInfo(!0),window.treeViewer.hideMSAInfo(!1),w2ui.toolbar.click("msa"),w2ui.toolbar.click("fullSeq"),window.treeViewer.switchMsaView("fullSeq"),this.setupMSAPos(),window.treeViewer.displayTreeNoResize())}return!0},TreeViewer.prototype.setupMSAPos=function(){var e=this.msaInfo.getMinSelectedIndexRange();if(!(e<0)){for(var t=$("#treeviewer").jqGrid("getGridParam","colModel"),i=0,r=0;r<t.length;r++){var o=t[r];if(1!=o.hidden&&1!=o.frozen){if(this.msaCol===o.name){i+=e*this.msaInfo.getCharacterWidth();break}i+=o.width}}i>0&&(window.treeViewer.selectedColPos=i)}},TreeViewer.prototype.setupNodePositionInfo=function(){var e=$("#treeviewer tr ");console.log("There are "+(e.length-1)+" nodes");for(var t,i=1;i<e.length;i++){var r=$("#treeviewer")[0].rows[i];1===i&&(t=0);var o=$(r).outerHeight(!0),n=new RowTopHeight;n.setY(t),n.setHeight(o),t+=o,this.rowStartHeight.push(n)}this.calculatedRowHeights=!0,this.treeInfo.setNodePositions(this.rowStartHeight)},TreeViewer.prototype.setupNodePositionInfoOrig=function(){console.log("setup node position called");var e=$("#treeviewer tr ");console.log("There are "+e.length+" rows");for(var t,i=1;i<e.length;i++){var r=e.get(i);1===i&&(t=0);var o=$(r).children().eq(1),n=o.offset(),a=o.position();n.bottom=n.top+o.height();var s=o[0].getBoundingClientRect(),d=(o.height,s.height,o.offset(),new RowTopHeight);d.setY(a.top),d.setHeight(s.height),t+=s.height,this.rowStartHeight.push(d)}this.calculatedRowHeights=!0,this.treeInfo.setNodePositions(this.rowStartHeight)},TreeViewer.prototype.loadDataFromTree=function(){var e=this.treeInfo.getAllNodes(),t=this.getTreeRowData(e),i={};i.datatype="local",i.rowNum=t.length,i.data=t,$("#treeviewer").jqGrid("clearGridData"),$("#treeviewer").jqGrid("setGridParam",i),$("#treeviewer").trigger("reloadGrid");e=$("#treeviewer tr ");this.setupNodePositionInfo()},TreeViewer.prototype.defaultProcessing=function(){if(this.treeInfo.collapseLowestLevelSubfamily(),this.treeInfo.ladderTop(),this.treeInfo.colorBySubfamily(),void 0!=this.msaInfo){var e=this.msaInfo.getTitle();$("#treeviewer").jqGrid("setLabel",this.msaCol,e,{"text-align":"left","font-family":"monospace"},{title:"msa"}),null!==this.msaInfo&&$("#treeviewer").jqGrid("hideCol","msa")}},TreeViewer.prototype.displayTreeNoResize=function(){var e=this.treeInfo.getNodes(),t=this.getTreeRowData(e),i=$("#treeviewer").jqGrid("getGridParam");i.datatype="local",i.rowNum=t.length,i.data=t,this.vScrollposition=$("#treeviewer").closest(".ui-jqgrid-bdiv").scrollTop(),this.hScrollposition=$("#treeviewer").closest(".ui-jqgrid-bdiv").scrollLeft(),$("#treeviewer").trigger("reloadGrid"),this.setColors(t),$("#treeviewer").jqGrid("setFrozenColumns")},TreeViewer.prototype.getTreeRowData=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],o=r.getSubfamilyInfo(),n=r.getPropagatedSfName();void 0!==o&&(n=o.getSubfamilyName()),void 0===n&&(n="");var a=r.getAnnotationNodeId(),s="",d="",l="",w="",h=r.getLeafNodeInfo();void 0!==h&&(nodeName=h.getNodeName(),void 0==nodeName&&(nodeName=""),s=h.getDefinition(),null!==(d=h.getNodeName())&&void 0!==d&&d.indexOf("MGI=")>=0&&(d=d.replace("MGI=","")),void 0==d&&(d=""),l=h.getGeneSymbol(),w=h.getOrganism());var g=r.getMf(),c=r.getBp(),p=r.getCc(),f=r.getPc();void 0===g&&(g=""),void 0===c&&(c=""),void 0===p&&(p=""),void 0===f&&(f="");var u={id:a,tree:"treeImage",gene_id:d,gene_name:l,organism:w,definition:s,subfamily_name:n};u.attr=0===i?{tree:{rowspan:e.length},msa:{display:"none"}}:{tree:{display:"none"},msa:{display:"none"}},t.push(u)}return t},TreeViewer.prototype.getTreeRowDataForMSAView=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i].getAnnotationNodeId(),o={id:r,tree:"treeImage",gene_id:"",gene_name:"",organism:"",definition:""};o.attr=0===i?{tree:{rowspan:e.length},msa:{display:"none"}}:{tree:{display:"none"},msa:{display:"none"}},t.push(o)}return t},TreeViewer.prototype.getRowHeights=function(){var e=$("#treeviewer tr ");console.log("Just getting row heights there are "+e.length+" rows");for(var t,i=1;i<e.length;i++){var r=$("#treeviewer")[0].rows[i],o=r.getBoundingClientRect();1===i&&(t=0);var n=$(r).outerHeight(!0);o.bottom-o.top!=n&&console.log("Got different value here"),console.log("Height for row "+i+" is "+n+" top is "+t)}},TreeViewer.prototype.jqGridAfterGridComplete=function(){if(0!=window.treeViewer.calculatedRowHeights){if(1==window.treeViewer.redoRowHeights){var e=$("#treeviewer tr ");console.log("After load complete there are "+e.length+" rows");for(var t,i=1;i<e.length;i++){var r=$("#treeviewer")[0].rows[i],o=r.getBoundingClientRect();1===i&&(t=0);var n=$(r).outerHeight(!0);o.bottom-o.top!=n&&console.log("Got different value here"),console.log("Height for row "+i+" is "+n+" top is "+t);var a=window.treeViewer.rowStartHeight[i-1];a.setY(t),a.setHeight(n),t+=n}window.treeViewer.treeInfo.setNodePositions(window.treeViewer.rowStartHeight),window.treeViewer.redoRowHeights=!1,this.treeInfo.resetGraphObject()}}else{if(1==(e=$("#treeviewer tr ")).length)return;window.treeViewer.defaultProcessing()}},TreeViewer.prototype.setColors=function(e){for(var t=0;t<e.length;t++)for(var i=e[t].id,r=this.treeInfo.getNode(i).getColor(),o=this.treeInfo.getNode(i).getBgColor(),n=0;n<columnModel.length;n++){var a=columnModel[n].name;"msa"!==a&&"tree"!==a&&"gene_id"!==a?void 0===o?$("#treeviewer").jqGrid("setCell",i,a,"",{color:r}):$("#treeviewer").jqGrid("setCell",i,a,"",{color:r,"background-color":o}):"gene_id"===a&&(void 0===o?$("#treeviewer").jqGrid("setCell",i,a,"",{color:"#325F99"}):$("#treeviewer").jqGrid("setCell",i,a,"",{"background-color":o}))}},TreeViewer.prototype.updateSize=function(){console.log("Update size start "+Date());var e=$("tr",this);$("tr","#"+$(this).attr("id")+"_frozen").each(function(t,i){$(i).height($(e[t]).innerHeight()-(t%2?1:0))}),console.log("Update size end "+Date())},TreeViewer.prototype.setupMsaTreeInfo=function(){columnModel=[{name:this.gridCols[0],label:this.gridLabels[0],width:600,autoResizable:!1,frozen:!0,cellattr:this.arrtSetting,title:!1,formatter:this.svgFormatter},{name:this.gridCols[1],label:this.gridLabels[1],width:200,autoResizing:{},frozen:!0},{name:this.gridCols[2],label:this.gridLabels[2]},{name:this.gridCols[3],label:this.gridLabels[3]},{name:this.gridCols[4],label:this.gridLabels[4]},{name:this.gridCols[5],label:this.gridLabels[5]}];var e=!0;if(void 0!==this.msaInfo){e=!1;var t=document.getElementById("msa_check"),i=t.getContext("2d");i.font="normal 14px monospace",i.letterSpacing="0px";var r=i.measureText("W").width;t.parentNode.removeChild(t),this.msaInfo.setCharacterWidth(r),this.treeInfo.setCharacterWidth(r);var o=this.msaInfo.getFullSeqHeader(),n=this.msaInfo.getWidth();columnModel.push({name:this.msaCol,label:o,width:n,aligh:"left",title:!1,formatter:this.msaFormatter})}$("#toolbar").addClass("padding: 4px; border: 1px solid silver; border-radius: 3px"),$("#toolbar").w2toolbar({name:"toolbar",items:[{type:"menu",id:"tree",group:"msaGrid",caption:"Tree",items:[{id:"collapse_lowest_level_subfamily",text:"Collapse Lowest Level Subfamily"},{id:"expand_all_subfamily_nodes",text:"Expand All Subfamily Nodes"},{id:"reset_root_to_main",text:"Reset Root to Main"},{id:"expand_all_nodes",text:"Expand All Nodes"},{id:"ladder_top",text:"Ladder Top"},{id:"ladder_bottom",text:"Ladder Bottom"},{id:"ladder_original",text:"Ladder Original"}]},{type:"html",id:"scale_label",html:"Scale:  "},{type:"break",id:"break_1"},{type:"html",html:' <div id="tree_slider" ></div>'},{type:"break",id:"break0"},{type:"radio",id:"phylo",group:"phyloDetailed",caption:"Phylogenetic",checked:!0},{type:"break",id:"break5"},{type:"radio",id:"detailed",group:"phyloDetailed",caption:"Detailed",checked:!1},{type:"break",id:"break6"},{type:"radio",id:"msa",group:"msaGrid",caption:"MSA",hidden:e},{type:"break",id:"break1"},{type:"radio",id:"grid",group:"msaGrid",caption:"Grid",checked:!0},{type:"break",id:"break2"},{type:"radio",id:"fullSeq",group:"fullMatch",caption:"Entire Alignment",checked:!0,hidden:!0},{type:"break",id:"break3",hidden:!0},{type:"radio",id:"matchState",group:"fullMatch",caption:"Trimmed Alignment",hidden:!0},{type:"break",id:"break4",hidden:!0},{type:"radio",id:"history",group:"fullMatch",caption:"Evolutionary History",hidden:!0}]}),w2ui.toolbar.on("*",function(e){if("click"===e.type){if("tree:collapse_lowest_level_subfamily"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.collapseLowestLevelSubfamily(),void window.treeViewer.handleSyncWithGridRowSize();if("tree:expand_all_subfamily_nodes"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.expandAllSubfamilyNodes(),void window.treeViewer.handleSyncWithGridRowSize();if("tree:reset_root_to_main"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.resetRootToMain(),void window.treeViewer.handleSyncWithGridRowSize();if("tree:expand_all_nodes"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.expandAllNodes(),void window.treeViewer.handleSyncWithGridRowSize();if("tree:ladder_top"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.ladderTop(),void window.treeViewer.handleSyncWithGridRowSize();if("tree:ladder_bottom"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.ladderBottom(),void window.treeViewer.handleSyncWithGridRowSize();if("tree:ladder_original"===e.target&&"click"===e.type)return window.treeViewer.treeInfo.ladderOriginal(),void window.treeViewer.handleSyncWithGridRowSize();if(("phylo"===e.target||"detailed"===e.target)&&"click"===e.type)return window.treeViewer.treeInfo.toggleView(),void window.treeViewer.handleSyncWithGridRowSize();"msa"===e.target&&"click"===e.type&&(w2ui.toolbar.show("fullSeq"),w2ui.toolbar.show("matchState"),w2ui.toolbar.show("break3"),w2ui.toolbar.show("history"),w2ui.toolbar.show("break4"),window.treeViewer.hideGridInfo(!0),window.treeViewer.hideMSAInfo(!1),$grid=$("#treeviewer")),"grid"===e.target&&"click"===e.type&&(w2ui.toolbar.hide("fullSeq"),w2ui.toolbar.hide("matchState"),w2ui.toolbar.hide("break3"),w2ui.toolbar.hide("history"),w2ui.toolbar.hide("break4"),window.treeViewer.hideGridInfo(!1),window.treeViewer.hideMSAInfo(!0),$grid=$("#treeviewer")),"fullSeq"===e.target&&"click"===e.type&&window.treeViewer.switchMsaView("fullSeq"),"matchState"===e.target&&"click"===e.type&&window.treeViewer.switchMsaView("matchState"),"history"===e.target&&"click"===e.type&&window.treeViewer.switchMsaView("history")}})},TreeViewer.prototype.switchMsaView=function(e){if(void 0!==this.msaInfo){"fullSeq"===e?this.msaInfo.setViewDefault():"matchState"===e?this.msaInfo.setViewMatchState():"history"===e&&this.msaInfo.setViewHistory();var t=this.msaInfo.getTitle();$("#treeviewer").jqGrid("setLabel",this.msaCol,t,{"text-align":"left","font-family":"monospace"},{title:"msa"});for(var i=this.msaInfo.getWidth(),r=$("#treeviewer").jqGrid("getGridParam","width"),o=$("#treeviewer").jqGrid("getDataIDs"),n=0;n<o.length;n++){var a=o[n],s=($("#treeviewer").jqGrid("getRowData",a),this.treeInfo.getNode(a).getParent()),d=void 0;void 0!==s&&(d=s.getAnnotationNodeId());var l=this.msaInfo.getSeqDisplay(a,d);$("#treeviewer").jqGrid("setCell",a,this.msaCol,l)}$("#treeviewer").jqGrid("setColWidth",this.msaCol,i,!1),$("#treeviewer").jqGrid("setGridWidth",r),window.treeViewer.displayTreeNoResize()}},TreeViewer.prototype.hideGridInfo=function(e){var t="hideCol";!1===e&&(t="showCol");for(var i=$("#treeviewer").jqGrid("getGridParam","width"),r=0;r<this.gridCols.length;r++)$("#treeviewer").jqGrid(t,this.gridCols[r]);$("#treeviewer").jqGrid("setGridWidth",i)},TreeViewer.prototype.hideMSAInfo=function(e){var t="hideCol";!1===e&&(t="showCol");var i=$("#treeviewer").jqGrid("getGridParam","width");$("#treeviewer").jqGrid(t,this.msaCol),$("#treeviewer").jqGrid("setGridWidth",i)},TreeViewer.prototype.setupTreeInfo=function(){var e=this.initData.treeData.responseInJSON.tree_info.annotation_node;void 0!==e?(this.treeInfo=new Tree,this.treeInfo.parse(e)):window.treeViewer.stopExecution=!0},TreeViewer.prototype.setupMsaInfo=function(){if(void 0!==this.initData.msa.responseInJSON.msa_info&&void 0!==this.initData.msa.responseInJSON.msa_info.msa){var e=this.initData.msa.responseInJSON.msa_info.msa.sequence_list;void 0!==e&&0!==e.length&&(this.msaInfo=new MSA,this.msaInfo.parse(e,null))}},TreeViewer.prototype.arrtSetting=function(e,t,i,r,o){var n,a=r.name,s=(i.attr[a],i.attr[r.name]);return s.rowspan&&(n=' rowspan="'+s.rowspan+'"'),s.display&&(n=' style="display:'+s.display+'"'),n},TreeViewer.prototype.msaFormatter=function(e,t,i){if(void 0!==e)return e;var r=t.rowId,o=window.treeViewer.treeInfo.getNode(r).getParent(),n=void 0;return void 0!==o&&(n=o.getAnnotationNodeId()),window.treeViewer.msaInfo.getSeqDisplay(r,n)},TreeViewer.prototype.gene_idFormatter=function(e,t,i){var r=t.rowId,o=window.treeViewer.treeInfo.getNode(r).getLeafNodeInfo();if(null===o||void 0===o)return"";var n=o.getNodeName();if(null!==n&&void 0!==n&&n.indexOf("MGI=")>=0&&(n=n.replace("MGI=","")),void 0!==n&&null!==n){var a=window.location.href,s=a.indexOf(window.location.pathname);return"<a href='"+(a=a.substring(0,s)+"/genes/gene.jsp?acc="+o.getNodeName())+"'  target='panthermain'>"+n+"</a>"}return""},TreeViewer.prototype.svgFormatter=function(e,t,i){var r=document.getElementById("treeSVG");if(void 0!==r&&null!==r&&r.parentNode.removeChild(r),!1===window.treeViewer.calculatedRowHeights)return"";var o=t.colModel.name,n=i.attr[o];if(void 0!==n&&"none"===n.display)return"";var a=window.treeViewer.treeInfo.getTreeSVG(t.colModel.width),s=$("#gbox_treeviewer").outerHeight(!0)-$("div.ui-widget-header.ui-corner-top.ui-jqgrid-titlebar.ui-jqgrid-caption").outerHeight(!0)-$(".ui-jqgrid-labels").outerHeight(!0),d=window.treeViewer.treeInfo.getTreeHeight()-5;return s>d?'<svg id="treeSVG" width="100%" height="'+d+'"> '+a+"</svg>":'<svg id="treeSVG" width="100%" height="100%"> '+a+"</svg>",'<svg id="treeSVG" width="100%" height="'+d+'"> '+a+"</svg>"},TreeViewer.prototype.handleSyncWithGridRowSize=function(){this.displayTreeNoResize()},TreeViewer.prototype.handleSyncWithGridRowSizeOrig=function(){if(this.displayTreeNoResize(),1==this.redoRowHeights){var e=$("#treeviewer tr ");console.log("After load complete there are "+e.length+" rows");for(var t,i=1;i<e.length;i++){var r=$("#treeviewer")[0].rows[i],o=r.getBoundingClientRect();1===i&&(t=0);var n=$(r).outerHeight(!0);o.bottom-o.top!=n&&console.log("Got different value here");var a=window.treeViewer.rowStartHeight[i-1];void 0==a&&(a=new RowTopHeight,window.treeViewer.rowStartHeight[i-1]=a),a.setY(t),a.setHeight(n),t+=n}e.length>1&&1==window.treeViewer.calculatedRowHeights&&(window.treeViewer.treeInfo.setNodePositions(window.treeViewer.rowStartHeight),this.treeInfo.resetGraphObject(),$("#treeviewer").trigger("jqGridResetFrozenHeights"),this.displayTreeNoResize(),window.treeViewer.redoRowHeights=!1)}},TreeViewer.prototype.expandSFSelectSf=function(e){void 0!==e&&null!==e&&0!==e.length&&this.treeInfo.expandSfSelectSf(e)},TreeViewer.prototype.selectMSAPos=function(e){if(void 0!==e&&null!==e&&!1!==$.isNumeric(e)){parseInt(e);this.msaInfo.setSelectedIndex(e)}},TreeViewer.prototype.selectSEQPosRange=function(e,t){void 0!==e&&null!==e&&!1!==$.isNumeric(e)&&void 0!==t&&null!==t&&!1!==$.isNumeric(t)&&this.msaInfo.setAminoAcidRange(e,t)},TreeViewer.prototype.beginGridRequest=function(e){},TreeViewer.prototype.endGridRequest=function(e){},TreeViewer.prototype.getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}}$(document).ready(function(){var e=new TreeViewer;window.treeViewer=e,e.displayLegend(),e.startProgressBar(),e.loadInfoFromServer(),$("#treeviewer").on("contextmenu",function(e){return e.stopImmediatePropagation(),!1})});